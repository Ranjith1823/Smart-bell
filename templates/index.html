<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holiday Manager - Authenticated</title>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 600px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .holiday-list {
            max-height: 300px;
            overflow-y: auto;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>

<!-- Login Section -->
<div class="container" id="loginSection">
    <h2 class="text-center">Admin Login</h2>
    <input type="email" id="email" class="form-control mt-2" placeholder="Email" required>
    <input type="password" id="password" class="form-control mt-2" placeholder="Password" required>
    <button class="btn btn-primary mt-2 w-100" onclick="login()">Login</button>
</div>

<!-- Holiday Manager Section (Hidden Until Login) -->
<div class="container hidden" id="dashboardSection">
    <h2 class="text-center">Holiday Manager</h2>
    <button class="btn btn-danger mb-2" onclick="logout()">Logout</button>

    <!-- Add Holiday Section (Only for Authenticated Users) -->
    <div id="adminControls" class="mb-3 hidden">
        <label class="form-label">Date:</label>
        <input type="date" id="holiday_date" class="form-control">
        <label class="form-label">Description:</label>
        <input type="text" id="holiday_description" class="form-control">
        <button class="btn btn-primary mt-2 w-100" onclick="addHoliday()">Add Holiday</button>
    </div>

    <!-- Holiday List (Visible to Everyone) -->
    <h3 class="mt-3">Holidays</h3>
    <ul id="holiday_list" class="list-group holiday-list"></ul>
</div>

<script>
    // Firebase Configuration
    const firebaseConfig = {
        apiKey: "AIzaSyBbWwuGdRwtDrwXHvHDb6SEv0Mb3TI2uSM",
        authDomain: "smart-bell-7b0c3.firebaseapp.com",
        databaseURL: "https://smart-bell-7b0c3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "smart-bell-7b0c3",
        storageBucket: "smart-bell-7b0c3.appspot.com",
        messagingSenderId: "117192677459",
        appId: "1:117192677459:web:3fa0ce9e5a7383e73ccea6"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    // ðŸ”¹ Check Authentication State
    auth.onAuthStateChanged(user => {
        if (user) {
            $("#loginSection").addClass("hidden");
            $("#dashboardSection").removeClass("hidden");
            $("#adminControls").removeClass("hidden");  // Show admin controls
            fetchHolidays();
        } else {
            $("#loginSection").removeClass("hidden");
            $("#dashboardSection").addClass("hidden");
            $("#adminControls").addClass("hidden");  // Hide admin controls
        }
    });

    // âœ… Login Function
    function login() {
        let email = $("#email").val();
        let password = $("#password").val();
        auth.signInWithEmailAndPassword(email, password)
            .then(() => {
                $("#email, #password").val(""); // Clear fields after login
            })
            .catch(error => alert(error.message));
    }

    // âœ… Logout Function
    function logout() {
        auth.signOut();
    }

    // âœ… Fetch Holidays (Everyone Can See)
    function fetchHolidays() {
        db.ref("holidays").once("value", snapshot => {
            let list = $("#holiday_list");
            list.empty();
            snapshot.forEach(child => {
                let data = child.val();
                list.append(`
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span><strong>${data.date}</strong>: ${data.description}</span>
                        ${auth.currentUser ? `<button class="btn btn-danger btn-sm" onclick="removeHoliday('${child.key}')">Remove</button>` : ""}
                    </li>
                `);
            });
        });
    }

    // âœ… Add Holiday (Only for Authenticated Users)
    function addHoliday() {
        let date = $("#holiday_date").val();
        let description = $("#holiday_description").val();
        if (!date || !description) {
            alert("Both fields are required!");
            return;
        }
        db.ref("holidays").push({ date, description })
            .then(() => {
                $("#holiday_date").val("");
                $("#holiday_description").val("");
                fetchHolidays();
            });
    }

    // âœ… Remove Holiday (Only for Authenticated Users)
    function removeHoliday(key) {
        if (confirm("Are you sure you want to remove this holiday?")) {
            db.ref("holidays/" + key).remove().then(fetchHolidays);
        }
    }
</script>

</body>
</html>
