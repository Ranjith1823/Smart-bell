<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holiday Manager</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js"></script>

    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 600px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .holiday-list {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>

<!-- Authentication Section -->
<div class="container" id="auth_section">
    <h2 class="text-center">Login</h2>
    <input type="email" id="login_email" class="form-control mb-2" placeholder="Email">
    <input type="password" id="login_password" class="form-control mb-2" placeholder="Password">
    <button class="btn btn-primary w-100" onclick="login()">Login</button>
    <button class="btn btn-secondary w-100 mt-2" onclick="signup()">Sign Up</button>
</div>

<!-- Holiday Manager (Hidden Until Login) -->
<div class="container" id="holiday_manager" style="display: none;">
    <h2 class="text-center">Holiday Manager</h2>

    <div class="mb-3">
        <label class="form-label">Date:</label>
        <input type="date" id="holiday_date" class="form-control">
        <label class="form-label">Description:</label>
        <input type="text" id="holiday_description" class="form-control">
        <button class="btn btn-primary mt-2 w-100" onclick="addHoliday()">Add Holiday</button>
    </div>

    <h3 class="mt-3">Holidays</h3>
    <ul id="holiday_list" class="list-group holiday-list"></ul>

    <!-- Logout Button -->
    <button class="btn btn-danger w-100 mt-3" onclick="logout()">Logout</button>
</div>

<script>
    const API_URL = "https://smart-bell.onrender.com";  // âœ… Flask API

    // ðŸ”¥ Firebase Config
    const firebaseConfig = {
        apiKey: "AIzaSyBbWwuGdRwtDrwXHvHDb6SEv0Mb3TI2uSM",
        authDomain: "smart-bell-7b0c3.firebaseapp.com",
        databaseURL: "https://smart-bell-7b0c3-default-rtdb.asia-southeast1.firebasedatabase.app",
        projectId: "smart-bell-7b0c3",
        storageBucket: "smart-bell-7b0c3.firebasestorage.app",
        messagingSenderId: "117192677459",
        appId: "1:117192677459:web:3fa0ce9e5a7383e73ccea6"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();

    function login() {
        let email = document.getElementById("login_email").value;
        let password = document.getElementById("login_password").value;

        auth.signInWithEmailAndPassword(email, password)
            .then(() => checkAuthState())
            .catch(error => alert(error.message));
    }

    function signup() {
        let email = document.getElementById("login_email").value;
        let password = document.getElementById("login_password").value;

        auth.createUserWithEmailAndPassword(email, password)
            .then(() => checkAuthState())
            .catch(error => alert(error.message));
    }

    function logout() {
        auth.signOut().then(() => checkAuthState());
    }

    function checkAuthState() {
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById("auth_section").style.display = "none";
                document.getElementById("holiday_manager").style.display = "block";
                fetchHolidays();
            } else {
                document.getElementById("auth_section").style.display = "block";
                document.getElementById("holiday_manager").style.display = "none";
            }
        });
    }

    function fetchHolidays() {
        $.ajax({
            url: `${API_URL}/get_holidays`,
            type: "GET",
            success: function(response) {
                let list = $("#holiday_list");
                list.empty();
                Object.keys(response).forEach(date => {
                    list.append(`<li class="list-group-item">${date}: ${response[date].description}</li>`);
                });
            },
            error: function() {
                alert("Error fetching holidays.");
            }
        });
    }

    checkAuthState();
</script>

</body>
</html>
