<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Holiday Manager</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body {
            padding: 20px;
            font-family: Arial, sans-serif;
            background-color: #f8f9fa;
        }
        .container {
            max-width: 600px;
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        .holiday-list {
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>

<div class="container">
    <h2 class="text-center">Holiday Manager</h2>

    <!-- Add Holiday Section -->
    <div class="mb-3">
        <label class="form-label">Date:</label>
        <input type="date" id="holiday_date" class="form-control">
        <label class="form-label">Description:</label>
        <input type="text" id="holiday_description" class="form-control">
        <button id="addHolidayBtn" class="btn btn-primary mt-2 w-100" onclick="addHoliday()">Add Holiday</button>
    </div>

    <!-- Holiday List -->
    <h3 class="mt-3">Holidays</h3>
    <ul id="holiday_list" class="list-group holiday-list"></ul>
</div>

<!-- Bootstrap Toast Notification -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 5">
    <div id="toastMessage" class="toast align-items-center text-white bg-success border-0" role="alert">
        <div class="d-flex">
            <div class="toast-body" id="toastText"></div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    </div>
</div>

<script>
    function formatDate(isoDate) {
        let date = new Date(isoDate);
        let day = String(date.getDate()).padStart(2, '0');
        let month = String(date.getMonth() + 1).padStart(2, '0');
        let year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }

    function sortDates(dates) {
        return dates.sort((a, b) => new Date(a) - new Date(b));
    }

    function showToast(message, isSuccess = true) {
        $("#toastText").text(message);
        $("#toastMessage").removeClass("bg-success bg-danger").addClass(isSuccess ? "bg-success" : "bg-danger").toast("show");
    }

    function fetchHolidays() {
        $.ajax({
            url: "/get_holidays",
            type: "GET",
            success: function(response) {
                let list = $("#holiday_list");
                list.empty();

                let sortedDates = sortDates(Object.keys(response));

                sortedDates.forEach(date => {
                    let formattedDate = formatDate(date);
                    list.append(`
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <span><strong>${formattedDate}</strong>: ${response[date].description}</span>
                            <button class="btn btn-danger btn-sm" onclick="removeHoliday('${date}')">Remove</button>
                        </li>
                    `);
                });
            },
            error: function(xhr) {
                showToast(`Error: ${xhr.responseJSON?.message || "Could not fetch holidays."}`, false);
            }
        });
    }

    function addHoliday() {
        let date = $("#holiday_date").val();
        let description = $("#holiday_description").val();

        if (!date || !description) {
            showToast("Both fields are required!", false);
            return;
        }

        $("#addHolidayBtn").prop("disabled", true).text("Adding...");

        $.ajax({
            url: "/add_holiday",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ date: date, description: description }),
            success: function(response) {
                showToast(response.message);
                $("#holiday_date").val("");
                $("#holiday_description").val("");
                fetchHolidays();
            },
            error: function(xhr) {
                showToast(`Error: ${xhr.responseJSON?.message || "Could not add holiday."}`, false);
            },
            complete: function() {
                $("#addHolidayBtn").prop("disabled", false).text("Add Holiday");
            }
        });
    }

    function removeHoliday(date) {
        if (!confirm(`Are you sure you want to remove this holiday?`)) return;

        $.ajax({
            url: "/remove_holiday",
            type: "POST",
            contentType: "application/json",
            data: JSON.stringify({ date: date }),
            success: function(response) {
                showToast(response.message);
                fetchHolidays();
            },
            error: function(xhr) {
                showToast(`Error: ${xhr.responseJSON?.message || "Could not remove holiday."}`, false);
            }
        });
    }

    $(document).ready(function() {
        fetchHolidays();

        $("#holiday_date, #holiday_description").keypress(function(event) {
            if (event.which === 13) addHoliday();
        });
    });
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
